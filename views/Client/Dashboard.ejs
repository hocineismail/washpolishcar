<% include _header %>
    <title> حسابي </title>

    <style>
        table {
  border-collapse: collapse;
  border-spacing: 0;
  width: 100%;
  border: 1px solid #ddd;
}
th {
  text-align: right;
  padding: 8px;
  font-size: 12px
}
 td {
 text-align: right;
  padding: 8px;
}

tr:nth-child(even){background-color: #f2f2f2}

 
  </style>
</head>
<body class="skin-blue"   style=" font-family: 'Cairo', sans-serif;">
  <div class="wrapper">
    
    <header class="main-header">
      <!-- Logo -->
      <a href="#" class="logo"><b style=" font-family: 'Cairo', sans-serif;">لوحة التحكم </b></a>
      <!-- Header Navbar: style can be found in header.less -->
      <nav class="navbar navbar-static-top" role="navigation">
        <!-- Sidebar toggle button-->
        <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
          <span class="sr-only">Toggle navigation</span>
        </a>
        <div class="navbar-custom-menu">
          <ul class="nav navbar-nav">
          
            <!-- Tasks: style can be found in dropdown.less -->
            
            <!-- User Account: style can be found in dropdown.less -->
            <li class="dropdown user user-menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                
                <img src="/images/user.svg" class="user-image"  alt="User Image" />
                <span class="hidden-xs"> 
                   <% if (currentUser) { %>
                    <%= currentUser.Firstname +" "+currentUser.Lastname  %> 
                  <% }  %> 
                    </span>
              </a>
              <ul class="dropdown-menu">
                <!-- User image -->
                <li class="user-header">
                  <img src="/images/user.svg" class="img-circle" alt="User Image" />
                  <p>
                      <% if (currentUser) { %>
                        <%= currentUser.Firstname +" "+currentUser.Lastname  %> 
                      <% }  %> 
                  </p>
                </li>
                <!-- Menu Body -->
               
                <!-- Menu Footer-->
                <li class="user-footer">
                    <div class="pull-left">
                        <a href="/client/My-Compte" class="btn btn-default btn-flat">الحساب</a>
                      </div>
                      <div class="pull-right">
                        <a href="/logout" class="btn btn-default btn-flat">تسجسل الخروج</a>
                      </div>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <!-- Left side column. contains the logo and sidebar -->
    <aside class="main-sidebar">
      <!-- sidebar: style can be found in sidebar.less -->
      <section class="sidebar" >
        <!-- Sidebar user panel -->
        <div class="user-panel">
          <div class="pull-left image">
            <img src="/images/user.svg" class="img-circle" alt="User Image" />
          </div>
          <div class="pull-left info">
            <p>
                <% if (currentUser) { %>
                  <%= currentUser.Firstname +" "+currentUser.Lastname  %> 
                <% }  %> 
            </p>

            <a href="#"><i class="fa fa-circle text-success"></i> موجود</a>
          </div>
        </div>
      
        <!-- sidebar menu: : style can be found in sidebar.less -->
        <ul class="sidebar-menu">
          <li class="header">الاعدادات  الرئيسية </li>
          <li class="active  treeview">
            <a href="/client">
              <i class="fa fa-dashboard"></i> <span>لوحة التحكم</span>  
            </a>            
          </li>
          <li class="treeview">
                  <a href="/client/my-Compte">
                    <i class="fas fa-user-alt"></i>&nbsp;
                    <span>حسابي</span>                  
                  </a>                  
            </li>
            <li class=" treeview">                  
                <a href="/client/funding">  <i class="fas fa-dollar-sign icon-service" ></i>&nbsp;  <span> الاحصائيات المالية</span> <i class="fa fa-angle-left pull-right"></i></a>
                
              
          
        </li>
          <li class="treeview">
              <a href="/client/map">
                  <i class="fas fa-map-marked"></i>&nbsp;
                <span>الخريطة</span>
              
              </a>
              
            </li>
        
        </ul>
      </section>
      <!-- MAPS 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000-->
      <!-- /.sidebar -->
    </aside>

    <!-- Right side column. Contains the navbar and content of the page -->
    <div class="content-wrapper" >
      <!-- Content Header (Page header) -->
      <section class="content-header"  style=" font-family: 'Cairo', sans-serif;"> 
        <h1  style=" font-family: 'Cairo', sans-serif; text-align: center;">
            صفحة الاحصاء         
        </h1>
   
      </section>

      <!-- Main content -->
      <section class="content">
     
        <div class="row">
            <div class="col-md-6">
                <!-- LINE CHART -->
               
                <!-- BAR CHART -->
                <div class="box box-success">
                  <div class="box-header">
                      <h5   style="text-align: center; font-family: 'Cairo', sans-serif;">اعمدة بيانية</h5>
                  </div>
                  <div class="box-body chart-responsive">
                    <div class="chart" id="bar-chart" style="height: 300px;"></div>
                  </div><!-- /.box-body -->
                </div><!-- /.box -->
  
              </div><!-- /.col (RIGHT) -->
          <div class="col-md-6">
            <!-- LINE CHART -->
           
            <!-- BAR CHART -->
            <div class="box box-success">
              <div class="box-header"style="text-align: right"> 
                  <h5   style="text-align: center; font-family: 'Cairo', sans-serif;"> دون مصاريفك اليومية</h5>
              </div>
              <div class="box-body chart-responsive"style="text-align: right"> 
                  <% var date =  new Date();%>
                  <% var day  = date.getDate()%>
                  <% var month = date.getUTCMonth() + 1%>
                  <% if (day < 10 ) { %>
                    <%   day  = '0' + day %>
                  <%}%>

                  <% if (month < 10  ) { %>
                    <%   month  = '0' + month%>
                  <%}%>
                  <%  var Year = date.getFullYear() %>
                 
                 
                  <% if (dayExist === 0 ) { %>
                <form action="/fundingday" method="post"style="text-align: right"> 
                  <%= Year + '-' + month +'-' + day   %>
                  <div class="form-group">
                    <label for="exampleInputEmail1">المدحول اليومي </label>
                    <input type="number" class="form-control" name="FinancialIncomeInDay" id="exampleInputEmail1" placeholder="come">
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">الكصروف الخارجي</label>
                    <input type="number" class="form-control" name="FinancialExitInDay" id="exampleInputPassword1" placeholder="exit">
                  </div>
                    
                  <button type="submit" class="btn btn-default">حفظ</button>
                </form>
                <% } else {  %>
                  <div style="overflow-x:auto; direction: rtl; " >
                      <table   >
                        <tr>
                          <th> التاريخ</th>
                          <th>المدخول المالي</th> 
                          <th> المخروج المالي</th>
                          <th>  الفوائد</th>
                          <th> الإعدادات</th>
                        </tr>                     
  
                          <tr >  
                              <td>  <%= Year + '-' + month +'-' + day   %></td>
                              <td style="color: green;"><%= dayExist.FinancialIncomeInDay %></td>
                              <td style="color: red"><%= dayExist.FinancialExitInDay%> </td>
                              <% var defience =  dayExist.FinancialIncomeInDay - dayExist.FinancialExitInDay %>
                              <% if (defience > 0) { %>
                                <td style="color: green"><%= defience  %> </td>
                              <% } else { %>
                                <td style="color: red"> <%= defience  %> </td>
                              <% } %>  

                              <td><button class="btn btn-default " data-toggle="modal" data-target="#exampleModalCenter<%= dayExist._id %>" type="button"> <i class="fas fa-cog"></i> تعديل</button></td>
                              <div class="modal fade" id="exampleModalCenter<%= dayExist._id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenter<%= dayExist._id %>Title" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                     
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                                    <div class="modal-body">
                                      <form action="/update-funding-day/null/<%= dayExist._id %>" method="post"style="text-align: right"> 
                                        <%= Year + '-' + month +'-' + day   %>
                                        <div class="form-group">
                                          <label for="exampleInputEmail1">المدحول اليومي </label>
                                          <input type="number" class="form-control" name="FinancialIncomeInDay" id="exampleInputEmail1" placeholder="come">
                                        </div>
                                        <div class="form-group">
                                          <label for="exampleInputPassword1">الكصروف الخارجي</label>
                                          <input type="number" class="form-control" name="FinancialExitInDay" id="exampleInputPassword1" placeholder="exit">
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">الغاء</button>
                                          <button type="submit" class="btn btn-primary">ارسال </button>
                                        </div>
                                       
                                      </form>
                                    </div>
                                    
                                  </div>
                                </div>
                              </div>
                            </tr>
                      </table>
                    </div>
                
                  <% } %>
              </div><!-- /.box-body -->
            </div><!-- /.box -->
               <!-- LINE CHART -->
               <% var monthInArabic = null%>
               <% if (thismonth.Month === 1 ) { %>
                 <% monthInArabic = "جانفي" %>                        
               <% } %>                        
               <% if (thismonth.Month === 2 ) { %>
                 <% monthInArabic = "فيفري" %>
               <% } %>
               <% if (thismonth.Month === 3 ) { %>
                 <% monthInArabic = "مارس" %>
               <% } %>                        
               <% if (thismonth.Month === 4 ) { %>
                 <% monthInArabic = "أفريل" %>
               <% } %>                        
               <% if (thismonth.Month === 5 ) { %>
                 <% monthInArabic = "ماي" %>
               <% } %>
               <% if (thismonth.Month === 6 ) { %>
                 <% monthInArabic = "جوان"%>
               <% } %>                        
               <% if (thismonth.Month === 7 ) { %>
                 <% monthInArabic = "جويلية" %>
               <% } %>                        
               <% if (thismonth.Month === 8 ) { %>
                 <% monthInArabic = "أوت" %>
               <% } %>                        
               <% if (thismonth.Month === 9 ) { %>
                 <% monthInArabic =  "سبتمبر"	%>
               <% } %>                                              
               <% if (thismonth.Month === 10 ) { %>
                 <% monthInArabic = 	"أكتوبر" %>
               <% } %>                        
               <% if (thismonth.Month === 11 ) { %>
                 <% monthInArabic = 	"نوفمبر" %>
               <% } %>                                              
               <% if (thismonth.Month === 12 ) { %>
                 <% monthInArabic = 		"ديسمبر" %>
               <% } %>

               <!-- BAR CHART -->
               <div class="box box-success">
                 <div class="box-header">
                   <h5   style="text-align: center;font-family: 'Cairo', sans-serif;">الاحصاء حسب ايام  شهر <%= monthInArabic%></h5>
                 </div>                                            
                 <div class="box-body chart-responsive">
                     <div style="overflow-x:auto; direction: rtl; " >
                         <table   >
                           <tr>
                             <th>اليوم</th>
                             <th>المدخول المالي</th> 
                             <th> المخروج المالي</th>
                             <th>  الفوائد</th>
                             <th> الإعدادات</th>
                           </tr>
                           <%  var year = 2019 %>
                           <%  var month = thismonth.Month + 1 %>
                           <% var monthInMonth =     new Date(year, month, 0).getDate();%>
                           <% for (var j = 1 ; j < monthInMonth + 1  ; j++) { %>
                             <% var IsExist = false %>
                           <% for (var i = 0 ; i < thismonth.day.length ; i++) { %>
                             
                              <% if ( (thismonth.day[i].Day) === (j )) { %>
                               <tr >  
                                 <td> <%= thismonth.day[i].Day %></td>
                                 <td style="color: green">  <%= thismonth.day[i].FinancialIncomeInDay.toFixed(2) %></td>
                                 <td style="color: red"> <%= thismonth.day[i].FinancialExitInDay.toFixed(2) %></td>
                                 <% var Def =  thismonth.day[i].FinancialIncomeInDay  - thismonth.day[i].FinancialExitInDay  %>
                                 <% if ( Def > 0 ) { %>
                                   <td style="color: green"> <%= Def.toFixed(2) %></td>
                                   <% } else { %>
                                     <td style="color: red"> <%= Def.toFixed(2) %></td>
                                   <% } %>                                  
                                 <td><button class="btn btn-default " style="color: black ; border-color: black;width: 132px " data-toggle="modal" data-target="#exampleModalCenter<%= thismonth.day[i]._id%>" type="button"> <i class="fas fa-cog"></i> تعديل المصروف</button></td>
                       
                                   <!-- Modal -->
                                   <div class="modal fade" id="exampleModalCenter<%= thismonth.day[i]._id%>" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenter<%= thismonth.day[i]._id%>Title" aria-hidden="true">
                                     <div class="modal-dialog modal-dialog-centered" role="document">
                                       <div class="modal-content">
                                         <div class="modal-header">                                           
                                           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                             <span aria-hidden="true">&times;</span>
                                           </button>
                                         </div>
                                         <div class="modal-body">

                                           <form action="/update-funding-day/null/<%= thismonth.day[i]._id %>" method="post"style="text-align: right"> 
                                             
                                             <h4 style="text-align: center;font-family: 'Cairo', sans-serif;"> <%=   thismonth.day[i].Day +' ' + monthInArabic    %></h4>
                                             <div class="form-group">
                                               <label for="exampleInputEmail1">المدخول اليومي </label>
                                               <input type="number" class="form-control" name="FinancialIncomeInDay" value="<%= thismonth.day[i].FinancialIncomeInDay.toFixed(2)  %>" id="exampleInputEmail1" placeholder="المدحول اليومي">
                                             </div>
                                             <div class="form-group">
                                               <label for="exampleInputPassword1">المخروج اليومي</label>
                                               <input type="number" class="form-control" name="FinancialExitInDay"  value="<%= thismonth.day[i].FinancialExitInDay.toFixed(2) %>" id="exampleInputPassword1" placeholder="المخروج اليومي">
                                             </div>
                                             <div class="modal-footer">
                                               <button type="button" class="btn btn-secondary" data-dismiss="modal">الغاء</button>
                                               <button type="submit" class="btn btn-primary">ارسال </button>
                                             </div>                                             
                                           </form>
                                         </div>                                          
                                       </div>
                                     </div>
                                   </div>
                               </tr>
                               <%  IsExist = true %>
                              <% } %>
                           
                           <% } %>
                           <% if (!IsExist) {  %>
                              
                             <tr >  
                               <td><%= j  %></td>
                               <td>0.00  </td>
                               <td> 0.00</td>                        
                               <td>0.00</td>
                               <td><button class="btn btn-default"  style="color: #3C8CBC; border-color: #3C8CBC;width: 132px" data-toggle="modal" data-target="#exampleModalCenter<%= j %>" type="button"><i class="fas fa-plus"></i>  اضف المصاريف</button></td>
                                                                    <!-- Modal -->
                                   <div class="modal fade" id="exampleModalCenter<%= j %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenter<%= j %>Title" aria-hidden="true">
                                     <div class="modal-dialog modal-dialog-centered" role="document">
                                       <div class="modal-content">
                                         <div class="modal-header">
                                           <h5 class="modal-title" id="exampleModalLongTitle">
                                           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                             <span aria-hidden="true">&times;</span>
                                           </button>
                                         </div>
                                         <div class="modal-body">
                                           <form action="/add-funding-day/<%= thismonth._id %>/<%= j %>/client" method="post"style="text-align: right"> 
                                             
                                             <h4 style="text-align: center;font-family: 'Cairo', sans-serif;">  <%= j   +' ' + monthInArabic    %></h4>
                                             <div class="form-group">
                                               <label for="exampleInputEmail1">المدخول اليومي </label>
                                               <input type="number" class="form-control" name="FinancialIncomeInDay"   id="exampleInputEmail1" placeholder="المدحول اليومي">
                                             </div>
                                           
                                             <div class="form-group">
                                               <label for="exampleInputPassword1">المخروج اليومي</label>
                                               <input type="number" class="form-control" name="FinancialExitInDay"    id="exampleInputPassword1" placeholder="المخروج اليومي">
                                             </div>
                                             <div class="modal-footer">
                                               <button type="button" class="btn btn-secondary" data-dismiss="modal">الغاء</button>
                                               <button type="submit" class="btn btn-primary">ارسال </button>
                                             </div>                                             
                                           </form>
                                         </div>
                                       </div>
                                     </div>
                                   </div>
                             </tr>
                             <% IsExist = false %>
                         <% } %>
                           <% } %>
                         </table>
                       </div>
                 </div><!-- /.box-body -->
               </div><!-- /.box -->
          </div><!-- /.col (RIGHT) -->       
          
        </div><!-- /.row -->
      </section><!-- /.content -->
    </div>
        <!-- Main row -->
     

      </section><!-- /.content -->
    </div><!-- /.content-wrapper -->
    <footer class="main-footer">
      <div   style="text-align: center">
          <strong>Copyright &copy; 2019 <a href="http://almsaeedstudio.com">HOCINE ISMAIL</a>.</strong> All rights reserved.
      </div>
     
    </footer>
  </div><!-- ./wrapper -->

  <!-- jQuery 2.1.3 -->
  <script src="/../../plugins/jQuery/jQuery-2.1.3.min.js"></script>
    <!-- Bootstrap 3.3.2 JS -->
    <script src="/../../bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <!-- Morris.js charts -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="/../../plugins/morris/morris.min.js" type="text/javascript"></script>
    <!-- FastClick -->
    <script src='/../../plugins/fastclick/fastclick.min.js'></script>
    <!-- AdminLTE App -->
    <script src="/../../dist/js/app.min.js" type="text/javascript"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="/../../dist/js/demo.js" type="text/javascript"></script>
 
    <script type="text/javascript">
      $(function () {
        "use strict";

        // AREA CHART
      
      
        //BAR CHART
        var bar = new Morris.Bar({
          element: 'bar-chart',
          resize: true,
          data: [
                           <%  var year = 2019 %>
                            <%  var month = thismonth.Month + 1 %>
                            <% var thismonthInMonth =     new Date(year, month, 0).getDate();%>
                            <% for (var j = 1 ; j < thismonthInMonth + 1  ; j++) { %>
                              <% var IsExist = false %>
                            <% for (var i = 0 ; i < thismonth.day.length ; i++) { %>
                              
                               <% if ( (thismonth.day[i].Day) === (j )) { %>
                                 {y: '<%= thismonth.day[i].Day %>', a:  <%= thismonth.day[i].FinancialIncomeInDay.toFixed(2) %>, b: <%= thismonth.day[i].FinancialExitInDay.toFixed(2) %>},
                            <%  IsExist = true %>
                               <% } %>
                            
                            <% } %>
                            <% if (!IsExist) {  %>
                              {y: '<%= j %>', a: 0, b: 0},
                              <% IsExist = false %>
                          <% } %>
                            <% } %>
          ],
          barColors: ['#145A32', '#F1948A  '],
          xkey: 'y',
          ykeys: ['a', 'b'],
          labels: ['مدخول مالي', 'مخروج مالي'],
          hideHover: 'auto'
        });
      });
    </script>

</body>
</html>
